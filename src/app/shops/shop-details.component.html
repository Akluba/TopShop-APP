<form class="ui form"
    novalidate
    (ngSubmit)="save()"
    [formGroup]="shopForm">

    <div class="ui massive input" [ngClass]="{'transparent': shopNameField}">
        <input type="text" formControlName="shop_name"
            (blur)="shopNameField = true"
            (focus)="shopNameField = false" />
    </div>

    <!-- Shop Categories Secondary menu -->
    <div class="ui pointing secondary menu">
        <a class="item" *ngFor="let element of formElements; let tab_i=index"
            [ngClass]="{'active': tab_i == 0}"
            attr.data-tab="{{ tab_i }}">{{ element.title }}</a>
    </div>

    <!-- Form Actions -->
    <div class="ui grid middle aligned content" style="min-height: 75px;">
        <div class="left floated thirteen wide column">
            <div class="ui hidden message transition">
                <div class="header" *ngIf="message">{{ message.text }}</div>
            </div>
        </div>
        <div class="right floated three wide column">
            <button class="ui fluid positive button"
                    [disabled]="!shopForm.valid || !shopForm.dirty">
                Save
            </button>
        </div>
    </div>

    <!-- Shop Category segments -->
    <div class="ui tab segment" *ngFor="let element of formElements; let tab_i=index"
        [ngClass]="{'active': tab_i == 0}"
        attr.data-tab="{{ tab_i }}">

        <div *ngIf="element.title === 'Notes'; then noteTemplate else inputLogTemplate"></div>

        <!-- Note Segment -->
        <ng-template #noteTemplate>
            <div class="ui grid">
                <div class="four wide column left floated">
                    <div class="ui vertical pointing notes tiny menu">
                        <a class="item" *ngFor="let field of element.fields; let note_i=index"
                        [ngClass]="{'active': note_i == 0}"
                        attr.data-tab="{{ tab_i }}/{{ note_i }}">{{ field.title }}</a>
                    </div>
                </div>
                <div class="twelve wide column right floated">
                    <div class="ui tab segment" *ngFor="let field of element.fields; let note_i=index" style="margin: 0;"
                        [ngClass]="{'active': note_i == 0}"
                        attr.data-tab="{{ tab_i }}/{{ note_i }}">
                        <note-feed
                            formArrayName="{{ field.column_name }}"
                            [field]="field"
                            [existingNotes]="shop[field.column_name]"
                            [newNote]="shopForm.get(field.column_name)">
                        </note-feed>
                    </div>
                </div>
            </div>
        </ng-template>

        <!-- Inputs / Logging Fields Segment -->
        <ng-template #inputLogTemplate>
            <div class="field" *ngFor="let field of element.fields">

                <div *ngIf="field.type === 'log'; then loggingFieldTemplate else inputTemplate"></div>

                <!-- Input Field -->
                <ng-template #inputTemplate>
                    <div class="ui grid middle aligned content">
                        <div class="right aligned four wide column">
                            <label>{{ field.title }}</label>
                        </div>
                        <div class="ten wide column">
                            <field-control
                                [formGroup]="shopForm"
                                [control]="field">
                            </field-control>
                        </div>
                    </div>
                </ng-template>

                <!-- Logging Field -->
                <ng-template #loggingFieldTemplate>
                    <logging-field
                        formArrayName="{{ field.column_name }}"
                        [field]="field"
                        [logEntries]="shopForm.get(field.column_name)">
                    </logging-field>
                </ng-template>

            </div>
        </ng-template>
    </div>
</form>